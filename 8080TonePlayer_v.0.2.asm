#target bin
#charset ascii
.asm8080
#code MAIN, 	0800h,*
MainStart:
	LXI 	H,Pauses
	PUSH	H
	LXI 	D,Notes
	LXI 	B,Times
MainLoop:
	LDAX 	D
	MOV 	L,A
	INX 	D
	LDAX 	D
	MOV 	H,A
	PUSH	H
	LDAX 	B
	MOV 	L,A
	INX 	B
	LDAX 	B
	MOV 	H,A
	ORA 	L
	JZ 		TimesEnd
	XCHG
	XTHL
	PUSH	B
	XCHG
	MOV		A,H
	ORA		L
	JZ		SkipTone
	CALL	TONE
NextPass:
	POP		B
	POP		H
	XTHL
	MOV		D,H
	MOV		E,L
	LDAX	D
	MOV		L,A
	INX		D
	LDAX	D
	MOV		H,A
	INX		D
	XCHG
	XTHL
	PUSH	H
	PUSH	B
	MOV		H,D
	MOV		L,E
	MOV 	A,H
	ORA 	L
	JZ 		ZeroPause
	CALL	Delay_ms
ZeroPause:
	POP		B
	POP		D
	INX 	B
	INX 	D
	JMP		MainLoop
SkipTone:
	CALL	Delay_ms
	JMP		NextPass
TimesEnd:
	INX		SP
	INX		SP
	INX		SP
	INX		SP
Stop:
	DI
StopLoop:
	HLT
	JMP
DELAY_1ms::
	LXI		D,0103				; 103 - 2.5MHz, 82 - 2.0MHz, 72 - 1.77MHz
delay_1ms_loop:
	DCX 	D
	MOV 	A,D
	ORA 	E
	JNZ 	delay_1ms_loop
	RET
DELAY_ms::
	LXI		D,0096				; 98 - 2.5MHz
delay_ms_loop:
	DCX 	D
	MOV 	A,D
	ORA 	E
	JNZ 	delay_ms_loop
	DCX		H
	MOV		A,H
	ORA		L
	JNZ		DELAY_ms
	RET
MUL16::
	MOV		C,L
	MOV		B,H
	LXI		H,0000
	MVI		A,15
MLP:
	PUSH	PSW
	ORA		D
	JP		MLP1
	DAD		B
MLP1:
	DAD		H
	XCHG
	DAD		H
	XCHG
	POP		PSW
	DCR		A
	JNZ		MLP
	ORA		D
	RP
	DAD		B
	RET
DIV16::
	MOV		A,E
	ORA		D
	JNZ		DIVIDE
	LXI		H,0000
	MOV		D,H
	MOV		E,L
	STC
	RET
DIVIDE:
	MOV		C,L
	MOV		B,H
	LXI		H,0000
	MVI		A,16
	ORA		A
DVLOOP:
	PUSH	PSW
	MOV		A,C
	RAL
	MOV		C,A
	MOV		A,B
	RAL
	MOV		B,A
	MOV		A,L
	RAL
	MOV		L,A
	MOV		A,H
	RAL
	MOV		H,A
	PUSH	H
	MOV		A,L
	SUB		E
	MOV		L,A
	MOV		A,H
	SBB		D
	MOV		H,A
	CMC
	JC		DROP
	XTHL
	INX		SP
	INX		SP
	POP		PSW
	ORA		A
	DCR		A
	JNZ		DVLOOP
	JMP		END
DROP:
	INX		SP
	INX		SP
	POP		PSW
	STC
	DCR		A
	JNZ		DVLOOP
END:
	XCHG
	MOV		A,C
	RAL
	MOV		L,A
	MOV		A,B
	RAL
	MOV		H,A
	ORA		A
	RET
TONE::
	PUSH	D
	PUSH	D
	LXI		D,0010
	CALL	DIV16
	PUSH	H
	POP		H
	LXI		D,0010
	CALL	DIV16
	POP		D
	CALL	MUL16
	LXI		D,0020
	CALL	DIV16
	POP		D
	PUSH	H
	LXI		H,52000				; Calculate tone counter value (52000/tone)
	CALL	DIV16
	POP		D
ToneLoop:
	EI
	PUSH	H
ToneLoop1:
	DCX 	H
	MOV 	A,H
	ORA 	L
	JNZ		ToneLoop1
	POP		H
	PUSH	H
	DI
ToneLoop0:
	DCX 	H
	MOV 	A,H
	ORA 	L
	JNZ 	ToneLoop0
	POP		H
	DCX		D
	MOV 	A,D
	ORA 	E
	JNZ		ToneLoop
	RET
#code PlayStream, *
Notes:
;; Imperial March
;	DW	390,390,390,310,460,390,310,460,390,580,580,580,620,460,360,310,460,390,780,390,390,780
;	DW	730,690,650,620,650,410,550,520,490,460,440,460,310,360,310,460,390
;; Pirates of the Caribbean
	DW	140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,140,290,220,260,290
	DW	290,290,320,340,340,340,390,320,320,290,260,260,290,220,260,290,290,290,320,340,340,349
	DW	390,320,320,290,260,290,220,260,290,290,290,340,390,390,390,440,460,460,440,390,440,290
	DW	290,320,340,340,390,440,290,290,340,320,320,340,290,320,220,260,290,290,290,320,340,349
	DW	340,390,320,320,290,260,260,290,220,260,290,290,290,320,340,340,340,390,320,320,290,260
	DW	290,220,260,290,290,290,340,390,390,390,440,460,460,440,390,440,290,290,320,340,340,390
	DW	440,290,290,340,320,320,290,260,290,290,320,320,340,340,390,440,340,290,220,460,340,290
	DW	220,290,340,340,440,340,340,440,390,320,390,320,440,340,440,340,340,440,390,340,320,290
	DW	290,320,340,390,440,390,340,320,340,390,440,390,340,390,440,390,340,320,340,320,290,320
	DW	260,290,290,320,340,320,340,390,340,390,440,390,340,290,290,320,340,390,440,460,290,390
	DW	340,390,320,290,320,260,440,440,440,440,440,440,390,390,340,320,340,320,290,440,460,440
	DW	440,440,440,390,390,340,320,340,320,290,220,290,340,440,220,290,340,460,220,290,340,440
	DW	440,520,440,390,390,340,320,340,320,290,220,290,340,440,220,290,340,460,220,290,340,440
	DW	440,520,440,390,390,340,320,340,320,290
;; Nu, pogodi!
;	DW	690,520,580,440,520,390,440,390,340,260,277,310,340,410,550,460,410,340,277,310,340,415
;	DW	550,460,410,340,260,290,320,390,520,440,390,320,260,290,320,390,520,440,390,320,690,523
;	DW	580,440,520,390,440,390,340,260,320,290,360,320,410,360,460,410,520,460,580,520,650,587
;	DW	730,650,730,830,932,650,730,830,580,650,730,520,580,580,550,580,690,880,690,580,550,587
;	DW	690,880,580,550,580,650,880,650,580,550,580,650,880,520,580,650,690,783,650,783,650,523
;	DW	440,520,620,730,620,730,620,490,410,490,580,690,580,690,580,460,390,460,550,650,550,659
;	DW	550,460,360,460,690,520,580,440,520,390,440,390,340,260,550,460,550,460,410,340,410,466
;	DW	550,460,550,460,410,340,410,440,520,440,520,440,390,320,390,440,520,440,520,440,390,320
;	DW	390,440,620,620,650,690,000,000
;;;
Times:
;; Imperial March
;	DW	350,350,350,250,100,350,250,100,700,350,350,350,250,100,350,250,100,700,350,250,100,350
;	DW	250,100,100,100,450,150,350,250,100,100,100,450,150,350,250,100,750,000,000
;; Pirates of the Caribbean
	DW	200,100,200,100,200,100,100,100,100,200,100,200,100,200,100,100,100,100,310,100,100,200
	DW	200,100,100,200,200,100,100,200,200,100,100,100,200,100,100,200,200,100,100,200,200,102
	DW	100,200,200,100,100,310,100,100,200,200,100,100,200,200,100,100,200,200,100,100,100,200
	DW	100,100,200,200,200,100,200,100,100,200,200,100,100,310,100,100,200,200,100,100,200,200
	DW	100,100,200,200,100,100,100,200,100,100,200,200,100,100,200,200,100,100,200,200,100,102
	DW	310,100,100,200,200,100,100,200,200,100,100,200,200,100,100,100,200,100,100,200,200,200
	DW  100,200,100,100,310,100,100,100,200,180,200,200,200,200,200,410,100,100,410,410,200,610
	DW 	310,310,310,200,200,200,100,100,200,200,200,100,100,200,200,200,100,100,200,200,200,310
	DW	100,100,310,100,200,200,200,200,200,200,200,410,100,100,310,100,200,200,200,200,310,102
	DW	200,200,100,100,310,100,200,200,200,200,200,200,200,200,100,100,200,200,200,200,200,200
	DW	310,100,200,310,100,200,200,200,200,200,200,100,100,200,200,200,200,200,410,200,200,200
	DW	200,200,100,100,200,200,200,200,200,200,100,100,100,200,100,100,100,310,100,100,100,200
	DW	200,200,100,100,200,200,200,200,200,200,100,100,100,200,100,100,100,310,100,100,100,200
	DW	200,200,100,100,200,200,200,200,200,410,000,000
;; Nu, pogodi!
;	DW	370,370,370,370,370,190,370,190,190,190,100,100,100,100,100,100,100,100,100,100,100,100
;	DW	100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,370,376
;	DW	370,370,370,190,370,190,190,190,100,100,100,100,100,100,100,100,100,100,100,100,100,100
;	DW	100,100,100,100,190,100,100,190,100,100,190,100,100,100,100,100,100,100,100,100,100,100
;	DW	100,190,100,100,100,100,100,100,100,100,100,100,190,100,100,100,100,100,100,100,100,100
;	DW	100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100
;	DW	100,100,100,100,370,370,370,370,370,190,370,190,190,190,100,100,100,100,100,100,100,100
;	DW	100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100
;	DW	100,100,1500,190,190,370,000,000
;;;
Pauses:
;; Imperial March
;	DW	350,350,350,250,100,350,250,100,700,350,350,350,250,100,350,250,100,700,350,250,100,350
;	DW	250,100,100,100,450,150,350,250,100,100,100,450,150,350,250,100,750,000,000
;; Pirates of the Caribbean
	DW	220,110,220,110,220,110,110,110,110,220,110,220,110,220,110,110,110,110,450,110,110,220
	DW	220,110,110,220,220,110,110,220,220,110,110,110,340,110,110,220,220,110,110,220,220,110
	DW	110,220,220,110,110,450,110,110,220,220,110,110,220,220,110,110,220,220,110,110,110,341
	DW	110,110,220,220,220,110,340,110,110,220,220,110,110,450,110,110,220,220,110,110,220,220
	DW	110,110,220,220,110,110,110,340,110,110,220,220,110,110,220,220,110,110,220,220,110,110
	DW	450,110,110,220,220,110,110,220,220,110,110,220,220,110,110,110,340,110,110,220,220,220
	DW	110,340,110,110,340,110,110,110,220,199,220,220,220,220,220,450,110,110,680,450,220,680
	DW	340,340,680,220,220,220,110,570,220,220,220,110,570,220,220,220,110,570,220,220,220,450
	DW	110,110,340,110,220,220,220,220,220,220,220,450,110,110,340,110,220,220,220,220,340,110
	DW	220,450,110,110,340,110,220,220,220,220,220,220,220,450,110,110,220,220,220,220,220,220
	DW	340,110,220,340,110,220,680,680,220,220,220,110,570,680,680,220,220,220,680,680,680,220
	DW	220,220,110,570,680,680,220,220,220,340,110,110,110,340,110,110,110,340,110,110,110,220
	DW	220,220,110,570,680,680,220,220,220,340,110,110,110,340,110,110,110,340,110,110,110,220
	DW	220,220,110,570,680,680,220,220,220,450,000,000
;; Nu, pogodi!
;	DW	370,370,370,370,370,190,370,190,190,190,100,100,100,100,100,100,100,100,100,100,100,100
;	DW	100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,370,376
;	DW	370,370,370,190,370,190,190,190,100,100,100,100,100,100,100,100,100,100,100,100,100,100
;	DW	100,100,100,100,190,100,100,190,100,100,190,100,100,100,100,100,100,100,100,100,100,100
;	DW	100,564,100,100,100,100,100,100,100,100,100,100,190,100,100,100,100,100,100,100,100,100
;	DW	100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100
;	DW	100,100,100,100,370,370,370,370,370,190,370,190,190,190,100,100,100,100,100,100,100,100
;	DW	100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100
;	DW	100,100,2000,190,190,370,000,000
;;
;
SW_Name:		DM	"8080TonePlayer",0
SW_CopyRight:	DM	"Software copyright (C) 2025 R2AKT",0
SW_License:		DM	"Software licensed under MIT",0
SW_Version		DM	"v.0.0.2 BETA",0

